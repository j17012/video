{% extends 'app/base.html' %}

{% block content %}
    <div class="player">
        <div class="video">
            <!--動画再生部分-->
            <video id="video" width="1215" height="480" controls></video><br/>
            <!--動画ファイルを選択する-->
            <p>ファイルを選択して下さい<br/></p>
            <input type="file" id="filename" value="ファイル読み込み"/><br/>
        </div>

        <div class="label">
            <canvas id="ex_chart"></canvas>
        </div>

        <div class="label_info">
            <h2>ラベル情報</h2>
            <table border="1">
                <tr>
                    <th>sec</th>
                    <th>man</th>
                    <th>pc_char</th>
                    <th>white_board</th>
                    <th>char_red</th>
                    <th>char_yellow</th>
                    <th>human_char</th>
                </tr>
                {% for Label_info in data %}
                <tr>
                    <td>{{ Label_info.sec }}</td>
                    <td>{{ Label_info.man }}</td>
                    <td>{{ Label_info.pc_char }}</td>
                    <td>{{ Label_info.white_board }}</td>
                    <td>{{ Label_info.char_red }}</td>
                    <td>{{ Label_info.char_yellow }}</td>
                    <td>{{ Label_info.human_char }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <div class="video_link">
            <a href="{% url  'app:index' %}">トップページ</a>
        </div>
    </div>

        <script>

            //選択された動画ファイルを再生する
            function init(){
                var f = document.getElementById("filename");
                f.addEventListener( "change", function (event) {
                    var URL = URL || webkitURL;
                    var file = event.target.files[0];
                    document.querySelector('video').src = URL.createObjectURL(file);
                    document.getElementById('filename').innerHTML = document.querySelector('video').src;
                }, false );
            }
    
            init()

            //ラベルバーの生成
            var ar = [
                moment("1970-01-01 00:00:21.000 +0000", "YYYY-MM-DD HH:mm:ss.SSS Z").format('x'),
                moment("1970-01-01 00:00:14.000 +0000", "YYYY-MM-DD HH:mm:ss.SSS Z").format('x'),
                moment("1970-01-01 00:00:36.000 +0000", "YYYY-MM-DD HH:mm:ss.SSS Z").format('x'),
                moment("1970-01-01 00:00:53.000 +0000", "YYYY-MM-DD HH:mm:ss.SSS Z").format('x'),
                moment("1970-01-01 00:00:47.000 +0000", "YYYY-MM-DD HH:mm:ss.SSS Z").format('x'),
                moment("1970-01-01 00:01:20.000 +0000", "YYYY-MM-DD HH:mm:ss.SSS Z").format('x')
            ];
            var ctx = document.getElementById("ex_chart").getContext("2d");
            var chart = new Chart(ctx, {
                type: "horizontalBar",
                data: {
                    labels: ["経過時間" ],
                    datasets: [{
                        label: "man",
                        data: [ar[0], ],
                        backgroundColor: "rgba(255, 0, 0, 0.8)",
                        borderWidth: 0
                    }, {
                        label: "pc_chara",
                        data: [ar[1], ],
                        backgroundColor: "rgba(0, 255, 0, 0.8)",
                        borderWidth: 0
                    }, {
                        label: "white_board",
                        data: [ar[2], ],
                        backgroundColor: "rgba(255, 153, 51, 0.8)",
                        borderWidth: 0
                    },{
                        label: "chara_red",
                        data: [ar[3], ],
                        backgroundColor: "rgba(255, 255, 0, 0.8)",
                        borderWidth: 0
                    }, {
                        label: "chara_yellow",
                        data: [ar[4], ],
                        backgroundColor: "rgba(128, 0, 128, 0.8)",
                        borderWidth: 0
                    }, {
                        label: "human_chara",
                        data: [ar[5], ],
                        backgroundColor: "rgba(0, 255, 255, 0.8)",
                        borderWidth: 0
                    } ]
                },
                options: {
                    maintainAspectRatio: false,
                    tooltips: {
                        callbacks: {
                            label: function(tooltipItem, data) {
                                let value = Number(tooltipItem.value);
                                let index = tooltipItem.datasetIndex;
                                let label = data.datasets[index].label;
                                let duration = moment(value, "x").format("m 分 s 秒 SSS");
                                return label + ":  " + duration;
                            }
                        },
                        position: "nearest"
                    },
                    scales: {
                        xAxes: [{
                            ticks: {
                                fontSize: 20,
                                stepSize: 10000,
                                min: 0,
                                callback: function(label, index, labels) {
                                    let duration = moment(label, "x").format("mm:ss");
                                    return duration;
                                }
                            }
                        }],
                        yAxes: [{
                            display: false,
                            categoryPercentage: 1.1
                        }]
                    },
                }
            });
            </script>
{% endblock %}

